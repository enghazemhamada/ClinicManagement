@{
    ViewData["Title"] = "Appointments";
}

<h3>Appointments</h3>
<a asp-action="Add" class="btn btn-primary mt-3 mb-3">Add Appointment</a>

<div class="mb-3">
    <input type="text" id="searchBox" placeholder="Patient name" class="form-control w-25 d-inline" />
    <input type="checkbox" id="upcomingFilter" />
    <label for="upcomingFilter">Upcoming Only</label>
    <button id="searchBtn" class="btn btn-primary">Search</button>
</div>

<table class="table" id="appointmentsTable">
    <thead>
        <tr>
            <th>Patient Name</th>
            <th>Appointment Date</th>
            <th>Total Appointments</th>
            <th></th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

@section Scripts {
    <script>
        function loadAppointments() {
            let search = $('#searchBox').val();
            let upcoming = $('#upcomingFilter').is(':checked');

            $.ajax({
                url: '/Appointment/GetAppointments',
                type: 'GET',
                data: { search: search, upcomingOnly: upcoming },
                success: function (data) {
                    let rows = '';
                    $.each(data, function (i, appointment) {
                        rows += `<tr>
                                    <td>${appointment.patientName}</td>
                                    <td>${appointment.appointmentDate}</td>
                                    <td>${appointment.totalAppointments}</td>
                                    <td>
                                        <a class="btn btn-primary" href="/Appointment/Edit/${appointment.id}">Edit</a>
                                        <a class="btn btn-danger" href="/Appointment/Delete/${appointment.id}">Delete</a>
                                    </td>
                                </tr>`;
                    });
                    $('#appointmentsTable tbody').html(rows);
                },
                error: function () {
                    $('#appointmentsTable tbody').html('<div class="alert alert-danger mt-3">Failed to load appointments.</div>');
                }
            });
        }

        $(document).ready(function () {
            loadAppointments();

            $('#searchBtn').click(function (e) {
                e.preventDefault();
                loadAppointments();
            });
        });
    </script>
}


